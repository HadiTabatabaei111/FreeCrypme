<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§ÛŒØ±Ø§Ù†ÛŒ â€” FreeCrypme</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #0f0f1b;
      color: #e0e0ff;
      margin: 0;
      padding: 15px;
    }
    h1 {
      text-align: center;
      color: #4fc3f7;
      margin: 10px 0;
      font-size: 24px;
    }
    .subtitle {
      text-align: center;
      color: #aaa;
      margin-bottom: 15px;
      font-size: 14px;
    }
    .search-box {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #444;
      background: #1e1e2f;
      color: white;
      border-radius: 6px;
      font-size: 15px;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin: 10px 0 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    select, input, button {
      padding: 8px 12px;
      border: 1px solid #444;
      background: #1e1e2f;
      color: white;
      border-radius: 6px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
    }
    th, td {
      padding: 10px 6px;
      text-align: center;
      border-bottom: 1px solid #2a2a40;
      font-size: 13px;
    }
    th {
      background: #1a1a2e;
      position: sticky;
      top: 0;
      font-weight: bold;
    }
    tr:hover {
      background: #25253a;
    }
    .pump { color: #4caf50; font-weight: bold; }
    .dump { color: #f44336; font-weight: bold; }
    .neutral { color: #ff9800; }
    .status {
      text-align: center;
      margin: 10px 0;
      color: #888;
      font-size: 13px;
    }
    .section-title {
      margin-top: 30px;
      padding-top: 15px;
      border-top: 1px solid #333;
      color: #4fc3f7;
      font-size: 18px;
      text-align: center;
    }
    .footer {
      text-align: center;
      margin-top: 20px;
      color: #666;
      font-size: 12px;
    }
    @media (max-width: 768px) {
      th, td { padding: 8px 4px; font-size: 12px; }
      h1 { font-size: 20px; }
    }
  </style>
</head>
<body>
  <h1>ğŸ‡®ğŸ‡· Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§ÛŒØ±Ø§Ù†ÛŒ</h1>
  <div class="subtitle">Ø±Ø§ÛŒÚ¯Ø§Ù† â€¢ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± â€¢ ÙÙ‚Ø· Ø¨Ø§ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡</div>

  <input type="text" id="globalSearch" class="search-box" placeholder="ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ù„ÛŒ (Ù†Ù…Ø§Ø¯ØŒ Ø³ÛŒÚ¯Ù†Ø§Ù„ØŒ RSI Ùˆ...)">

  <div class="controls">
    <select id="filterSignal">
      <option value="all">Ù‡Ù…Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</option>
      <option value="PUMP">ÙÙ‚Ø· Ù¾Ø§Ù…Ù¾</option>
      <option value="DUMP">ÙÙ‚Ø· Ø¯Ø§Ù…Ù¾</option>
      <option value="NEUTRAL">Ø®Ù†Ø«ÛŒ</option>
    </select>
    <input type="number" id="minVolume" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Ø­Ø¬Ù… (Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¯Ù„Ø§Ø±)" value="0" />
    <input type="number" id="minRSI" placeholder="Ø­Ø¯Ø§Ù‚Ù„ RSI" min="0" max="100" />
    <input type="number" id="maxRSI" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø± RSI" min="0" max="100" value="100" />
    <button onclick="loadSignals()">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯</button>
  </div>

  <!-- Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ: Ù‡Ù…Ù‡ Ø§Ø±Ø²Ù‡Ø§ -->
  <h2 style="text-align:center; margin:15px 0; font-size:18px;">ğŸ“Š Ù‡Ù…Ù‡ Ø§Ø±Ø²Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù†â€ŒØ´Ø¯Ù‡</h2>
  <table id="dataTable">
    <thead>
      <tr>
        <th>Ù†Ù…Ø§Ø¯</th>
        <th>Ù‚ÛŒÙ…Øª</th>
        <th>ØªØºÛŒÛŒØ± 1h</th>
        <th>Ø­Ø¬Ù…</th>
        <th>RSI</th>
        <th>MACD Hist</th>
        <th>Ø³ÛŒÚ¯Ù†Ø§Ù„</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr><td colspan="7">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...</td></tr>
    </tbody>
  </table>

  <div class="status" id="status">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: â€”</div>

  <!-- Ø¨Ø®Ø´ ÙˆÛŒÚ˜Ù‡: Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± (Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾ Ù‚ÙˆÛŒ) -->
  <div class="section-title">ğŸš¨ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ (Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾ Ù‚ÙˆÛŒ)</div>
  <table id="autoSignalsTable">
    <thead>
      <tr>
        <th>Ù†Ù…Ø§Ø¯</th>
        <th>Ù‚ÛŒÙ…Øª</th>
        <th>ØªØºÛŒÛŒØ± 1h</th>
        <th>RSI</th>
        <th>MACD Hist</th>
        <th>Ø³ÛŒÚ¯Ù†Ø§Ù„</th>
      </tr>
    </thead>
    <tbody id="autoSignalsBody">
      <tr><td colspan="6">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù‚ÙˆÛŒ...</td></tr>
    </tbody>
  </table>

  <div class="footer">
    ğŸ’Œ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ ØªÙˆØ³Ø· Ù‡Ø§Ø¯ÛŒ Ø§Ø² ØªÙ‡Ø±Ø§Ù† â€” Ø¨Ø±Ø§ÛŒ Ú©Ù…Ú© Ø¨Ù‡ Ù‡Ù…ÙˆØ·Ù†Ø§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ<br>
    <a href="https://freecrypme-2-abr3.onrender.com" target="_blank" style="color:#4fc3f7;">freecrypme-2-abr3.onrender.com</a>
  </div>

  <script>
    let allCoins = [];

    function filterData() {
      const globalQuery = document.getElementById('globalSearch').value.toLowerCase();
      const signalFilter = document.getElementById('filterSignal').value;
      const minVol = parseFloat(document.getElementById('minVolume').value) || 0;
      const minRSI = parseFloat(document.getElementById('minRSI').value) || 0;
      const maxRSI = parseFloat(document.getElementById('maxRSI').value) || 100;

      const filtered = allCoins.filter(coin => {
        // ÙÛŒÙ„ØªØ± Ú©Ù„ÛŒ (Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…ØªÙ†ÛŒ)
        const matchesSearch = 
          coin.symbol.toLowerCase().includes(globalQuery) ||
          coin.signal.toLowerCase().includes(globalQuery) ||
          String(coin.rsi).includes(globalQuery) ||
          String(coin.change_1h).includes(globalQuery);

        if (!matchesSearch) return false;
        if (signalFilter !== 'all' && coin.signal !== signalFilter) return false;
        if (coin.volume / 1e6 < minVol) return false;
        if (coin.rsi < minRSI || coin.rsi > maxRSI) return false;
        return true;
      });

      return filtered;
    }

    function renderMainTable(coins) {
      const tbody = document.getElementById('tableBody');
      if (coins.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
        return;
      }

      tbody.innerHTML = coins.map(c => `
        <tr>
          <td><b>${c.symbol}</b></td>
          <td>$${c.price.toLocaleString()}</td>
          <td style="color:${c.change_1h >= 0 ? '#4caf50' : '#f44336'}">
            ${c.change_1h >= 0 ? '+' : ''}${c.change_1h}%
          </td>
          <td>$${(c.volume / 1e6).toFixed(2)}M</td>
          <td>${c.rsi}</td>
          <td>${c.macd_hist.toFixed(6)}</td>
          <td class="${c.signal.toLowerCase()}">${c.signal}</td>
        </tr>
      `).join('');
    }

    function renderAutoSignals() {
      // ÙÙ‚Ø· Ù¾Ø§Ù…Ù¾/Ø¯Ø§Ù…Ù¾ Ø¨Ø§ RSI Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ + ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ù‚ÙˆÛŒ
      const strongSignals = allCoins.filter(c => 
        (c.signal === "PUMP" || c.signal === "DUMP") &&
        Math.abs(c.change_1h) >= 5 &&
        (c.rsi <= 35 || c.rsi >= 65)
      ).sort((a, b) => Math.abs(b.change_1h) - Math.abs(a.change_1h));

      const tbody = document.getElementById('autoSignalsBody');
      if (strongSignals.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">Ù‡ÛŒÚ† Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù‚ÙˆÛŒâ€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
        return;
      }

      tbody.innerHTML = strongSignals.map(c => `
        <tr>
          <td><b>${c.symbol}</b></td>
          <td>$${c.price.toLocaleString()}</td>
          <td style="color:${c.change_1h >= 0 ? '#4caf50' : '#f44336'}">
            ${c.change_1h >= 0 ? '+' : ''}${c.change_1h}%
          </td>
          <td>${c.rsi}</td>
          <td>${c.macd_hist.toFixed(6)}</td>
          <td class="${c.signal.toLowerCase()}">${c.signal}</td>
        </tr>
      `).join('');
    }

    function updateAll() {
      const filtered = filterData();
      renderMainTable(filtered);
      renderAutoSignals();
    }

    function loadSignals() {
      fetch('/signals.json?_=' + Date.now())
        .then(response => {
          if (!response.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡');
          return response.json();
        })
        .then(data => {
          allCoins = data.coins || [];
          document.getElementById('status').innerText = 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + data.last_update;
          updateAll();
        })
        .catch(err => {
          document.getElementById('tableBody').innerHTML = 
            `<tr><td colspan="7">âŒ ${err.message}</td></tr>`;
          document.getElementById('autoSignalsBody').innerHTML = 
            `<tr><td colspan="6">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</td></tr>`;
          console.error("Ø®Ø·Ø§:", err);
        });
    }

    // Ù…ØªØµÙ„ Ú©Ø±Ø¯Ù† eventÙ‡Ø§
    document.getElementById('globalSearch').addEventListener('input', updateAll);
    document.getElementById('filterSignal').addEventListener('change', updateAll);
    document.getElementById('minVolume').addEventListener('input', updateAll);
    document.getElementById('minRSI').addEventListener('input', updateAll);
    document.getElementById('maxRSI').addEventListener('input', updateAll);

    // Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡
    loadSignals();
    setInterval(loadSignals, 15000); // Ù‡Ø± 15 Ø«Ø§Ù†ÛŒÙ‡
  </script>
</body>
</html>
