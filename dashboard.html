<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§ÛŒØ±Ø§Ù†ÛŒ â€” FreeCrypme</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #0f0f1b;
      color: #e0e0ff;
      margin: 0;
      padding: 12px;
    }
    h1 {
      text-align: center;
      color: #4fc3f7;
      margin: 8px 0;
      font-size: 22px;
    }
    .subtitle {
      text-align: center;
      color: #aaa;
      margin-bottom: 12px;
      font-size: 13px;
    }
    .controls {
      display: flex;
      gap: 8px;
      margin: 8px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    select, input, button {
      padding: 6px 10px;
      border: 1px solid #444;
      background: #1e1e2f;
      color: white;
      border-radius: 4px;
      font-size: 13px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
    }
    th, td {
      padding: 8px 4px;
      text-align: center;
      border-bottom: 1px solid #2a2a40;
      font-size: 12px;
    }
    th {
      background: #1a1a2e;
      position: sticky;
      top: 0;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }
    th:hover {
      background: #222;
    }
    .filter-row th {
      padding: 4px;
      background: #151525;
    }
    .filter-row input, .filter-row select {
      width: 100%;
      padding: 4px;
      font-size: 11px;
    }
    tr:hover {
      background: #25253a;
    }
    .pump { color: #4caf50; font-weight: bold; }
    .dump { color: #f44336; font-weight: bold; }
    .neutral { color: #ff9800; }
    .status {
      text-align: center;
      margin: 8px 0;
      color: #888;
      font-size: 12px;
    }
    .initial-message {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>ğŸ‡®ğŸ‡· Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§ÛŒØ±Ø§Ù†ÛŒ</h1>
  <div class="subtitle">Ø±Ø§ÛŒÚ¯Ø§Ù† â€¢ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± â€¢ ÙÙ‚Ø· Ø¨Ø§ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡</div>

  <div class="controls">
    <select id="globalSignal">
      <option value="all">Ù‡Ù…Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</option>
      <option value="PUMP">ÙÙ‚Ø· Ù¾Ø§Ù…Ù¾</option>
      <option value="DUMP">ÙÙ‚Ø· Ø¯Ø§Ù…Ù¾</option>
    </select>
    <button onclick="loadSignals()">ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ</button>
  </div>

  <table id="dataTable">
    <thead>
      <tr id="headerRow">
        <th data-col="symbol">Ù†Ù…Ø§Ø¯ â–¼</th>
        <th data-col="price">Ù‚ÛŒÙ…Øª â–¼</th>
        <th data-col="change_1h">ØªØºÛŒÛŒØ± 1h â–¼</th>
        <th data-col="volume">Ø­Ø¬Ù… â–¼</th>
        <th data-col="rsi">RSI â–¼</th>
        <th data-col="macd_hist">MACD Hist â–¼</th>
        <th data-col="signal">Ø³ÛŒÚ¯Ù†Ø§Ù„ â–¼</th>
      </tr>
      <tr class="filter-row">
        <th><input type="text" placeholder="Ù†Ù…Ø§Ø¯" oninput="filterBy('symbol', this.value)"></th>
        <th><input type="text" placeholder="Ù‚ÛŒÙ…Øª" oninput="filterBy('price', this.value)"></th>
        <th><input type="text" placeholder="%Â±" oninput="filterBy('change_1h', this.value)"></th>
        <th><input type="text" placeholder="Ø­Ø¬Ù…" oninput="filterBy('volume', this.value)"></th>
        <th><input type="text" placeholder="RSI" oninput="filterBy('rsi', this.value)"></th>
        <th><input type="text" placeholder="MACD" oninput="filterBy('macd_hist', this.value)"></th>
        <th>
          <select onchange="filterBy('signal', this.value)">
            <option value="">Ù‡Ù…Ù‡</option>
            <option value="PUMP">PUMP</option>
            <option value="DUMP">DUMP</option>
            <option value="NEUTRAL">NEUTRAL</option>
          </select>
        </th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr><td colspan="7" class="initial-message">Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² Ø³Ø±ÙˆØ±...</td></tr>
    </tbody>
  </table>

  <div class="status" id="status">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: â€”</div>

  <script>
    let allCoins = [];
    let currentSort = { col: null, asc: true };
    let filters = {
      symbol: '', price: '', change_1h: '', volume: '', rsi: '', macd_hist: '', signal: ''
    };

    // Ù†Ù…Ø§ÛŒØ´ Ø³Ø±ÛŒØ¹â€ŒØªØ± Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚Ø¨Ù„ÛŒ (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡)
    function renderTable(coins) {
      const tbody = document.getElementById('tableBody');
      if (coins.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="initial-message">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
        return;
      }

      tbody.innerHTML = coins.map(c => `
        <tr>
          <td><b>${c.symbol}</b></td>
          <td>$${c.price.toLocaleString()}</td>
          <td style="color:${c.change_1h >= 0 ? '#4caf50' : '#f44336'}">
            ${c.change_1h >= 0 ? '+' : ''}${c.change_1h}%
          </td>
          <td>$${(c.volume / 1e6).toFixed(2)}M</td>
          <td>${c.rsi}</td>
          <td>${c.macd_hist.toFixed(6)}</td>
          <td class="${c.signal.toLowerCase()}">${c.signal}</td>
        </tr>
      `).join('');
    }

    function applyFiltersAndSort() {
      let result = allCoins.filter(coin => {
        for (let key in filters) {
          if (filters[key] === '') continue;
          const val = String(coin[key]).toLowerCase();
          if (key === 'signal') {
            if (coin[key] !== filters[key]) return false;
          } else if (key === 'volume' || key === 'price') {
            const numFilter = parseFloat(filters[key].replace(/[^0-9.-]/g, ''));
            if (isNaN(numFilter)) continue;
            if (coin[key] < numFilter * 1e6) return false;
          } else if (key === 'change_1h' || key === 'rsi' || key === 'macd_hist') {
            const num = parseFloat(filters[key]);
            if (!isNaN(num) && Math.abs(coin[key] - num) > 1) return false;
          } else {
            if (!val.includes(filters[key].toLowerCase())) return false;
          }
        }
        return true;
      });

      // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
      if (currentSort.col) {
        const col = currentSort.col;
        result.sort((a, b) => {
          let aVal = a[col], bVal = b[col];
          if (typeof aVal === 'string') {
            return currentSort.asc ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
          }
          return currentSort.asc ? aVal - bVal : bVal - aVal;
        });
      }

      renderTable(result);
    }

    function filterBy(col, value) {
      filters[col] = value;
      applyFiltersAndSort();
    }

    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ú©Ù„ÛŒÚ©
    document.querySelectorAll('th[data-col]').forEach(th => {
      th.addEventListener('click', () => {
        const col = th.getAttribute('data-col');
        if (currentSort.col === col) {
          currentSort.asc = !currentSort.asc;
        } else {
          currentSort.col = col;
          currentSort.asc = true;
        }
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÙ„Ø´
        document.querySelectorAll('th[data-col]').forEach(t => {
          t.textContent = t.textContent.replace(' â–²', '').replace(' â–¼', '') + ' â–¼';
        });
        th.textContent = th.textContent.replace(' â–¼', currentSort.asc ? ' â–²' : ' â–¼');
        applyFiltersAndSort();
      });
    });

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡
    async function loadSignals() {
      try {
        const res = await fetch('/signals.json?_=' + Date.now());
        if (!res.ok) throw new Error('Ø³Ø±ÙˆØ± Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª');
        const data = await res.json();
        allCoins = data.coins || [];
        document.getElementById('status').innerText = 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + data.last_update;
        applyFiltersAndSort();
      } catch (err) {
        document.getElementById('tableBody').innerHTML = 
          `<tr><td colspan="7" class="initial-message">âŒ ${err.message}</td></tr>`;
      }
    }

    // Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹
    loadSignals();
    setInterval(loadSignals, 15000);
  </script>
</body>
</html>
