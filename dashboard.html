<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ø§ÛŒØ±Ø§Ù†ÛŒ â€” Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #0f0f1b;
      color: #e0e0ff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #4fc3f7;
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      color: #aaa;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .controls {
      display: flex;
      gap: 12px;
      margin: 15px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    select, input, button {
      padding: 8px 12px;
      border: 1px solid #444;
      background: #1e1e2f;
      color: white;
      border-radius: 6px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    th, td {
      padding: 12px 8px;
      text-align: center;
      border-bottom: 1px solid #2a2a40;
    }
    th {
      background: #1a1a2e;
      position: sticky;
      top: 0;
      font-weight: bold;
    }
    tr:hover {
      background: #25253a;
    }
    .pump { color: #4caf50; font-weight: bold; }
    .dump { color: #f44336; font-weight: bold; }
    .neutral { color: #ff9800; }
    .status {
      text-align: center;
      margin-top: 15px;
      color: #888;
      font-size: 14px;
    }
    .footer {
      text-align: center;
      margin-top: 30px;
      color: #666;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h1>ğŸ‡®ğŸ‡· Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§ÛŒØ±Ø§Ù†ÛŒ</h1>
  <div class="subtitle">Ø±Ø§ÛŒÚ¯Ø§Ù† â€¢ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± â€¢ ÙÙ‚Ø· Ø¨Ø§ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡</div>

  <div class="controls">
    <select id="filterSignal">
      <option value="all">Ù‡Ù…Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</option>
      <option value="PUMP">ÙÙ‚Ø· Ù¾Ø§Ù…Ù¾</option>
      <option value="DUMP">ÙÙ‚Ø· Ø¯Ø§Ù…Ù¾</option>
    </select>
    <input type="number" id="minVolume" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Ø­Ø¬Ù… (Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¯Ù„Ø§Ø±)" value="0" />
    <button onclick="manualLoad()">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø³ØªÛŒ</button>
  </div>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Ù†Ù…Ø§Ø¯</th>
        <th>Ù‚ÛŒÙ…Øª</th>
        <th>ØªØºÛŒÛŒØ± 1h</th>
        <th>Ø­Ø¬Ù…</th>
        <th>RSI</th>
        <th>MACD Hist</th>
        <th>Ø³ÛŒÚ¯Ù†Ø§Ù„</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr><td colspan="7">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...</td></tr>
    </tbody>
  </table>

  <div class="status" id="status">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: â€”</div>

  <div class="footer">
    ğŸ’Œ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ ØªÙˆØ³Ø· Ù‡Ø§Ø¯ÛŒ Ø§Ø² ØªÙ‡Ø±Ø§Ù† â€” Ø¨Ø±Ø§ÛŒ Ú©Ù…Ú© Ø¨Ù‡ Ù‡Ù…ÙˆØ·Ù†Ø§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ
    <br>
    Ú©Ø¯ Ù…Ù†Ø¨Ø¹: <a href="https://github.com/HadiTabatabaei111/Hadi-Ta" target="_blank" style="color:#4fc3f7;">github.com/HadiTabatabaei111/Hadi-Ta</a>
  </div>

  <script>
    let allCoins = [];

    function updateTable() {
      const signal = document.getElementById('filterSignal').value;
      const minVol = parseFloat(document.getElementById('minVolume').value) || 0;

      const filtered = allCoins.filter(coin => {
        if (signal !== 'all' && coin.signal !== signal) return false;
        if (coin.volume / 1e6 < minVol) return false;
        return true;
      });

      const tbody = document.getElementById('tableBody');
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
        return;
      }

      tbody.innerHTML = filtered.map(c => `
        <tr>
          <td><b>${c.symbol}</b></td>
          <td>$${c.price.toLocaleString()}</td>
          <td style="color:${c.change_1h >= 0 ? '#4caf50' : '#f44336'}">
            ${c.change_1h >= 0 ? '+' : ''}${c.change_1h}%
          </td>
          <td>$${(c.volume / 1e6).toFixed(2)}M</td>
          <td>${c.rsi}</td>
          <td>${c.macd_hist.toFixed(6)}</td>
          <td class="${c.signal.toLowerCase()}">${c.signal}</td>
        </tr>
      `).join('');
    }

    function loadSignals() {
      fetch('/signals.json?_=' + Date.now())
        .then(response => {
          if (!response.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡');
          return response.json();
        })
        .then(data => {
          allCoins = data.coins || [];
          document.getElementById('status').innerText = 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + data.last_update;
          updateTable();
        })
        .catch(err => {
          document.getElementById('tableBody').innerHTML = 
            `<tr><td colspan="7">âŒ ${err.message}</td></tr>`;
          console.error("Ø®Ø·Ø§:", err);
        });
    }

    function manualLoad() {
      loadSignals();
    }

    document.getElementById('filterSignal').addEventListener('change', updateTable);
    document.getElementById('minVolume').addEventListener('input', updateTable);

    // Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡
    loadSignals();
    setInterval(loadSignals, 15000); // Ù‡Ø± 15 Ø«Ø§Ù†ÛŒÙ‡
  </script>
</body>
  </html>
