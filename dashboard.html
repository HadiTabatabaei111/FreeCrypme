<!-- dashboard.html -->
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ ğŸ“ˆ</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #0f0f1b;
      color: #e0e0ff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #4fc3f7;
    }
    .controls {
      display: flex;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    select, input, button {
      padding: 8px 12px;
      border: 1px solid #444;
      background: #1e1e2f;
      color: white;
      border-radius: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #2a2a40;
    }
    th {
      background: #1a1a2e;
      position: sticky;
      top: 0;
      cursor: pointer;
      user-select: none;
    }
    tr:hover {
      background: #25253a;
    }
    .pump { color: #4caf50; font-weight: bold; }
    .dump { color: #f44336; font-weight: bold; }
    .neutral { color: #ff9800; }
    .status {
      text-align: center;
      margin-top: 10px;
      color: #888;
    }
  </style>
</head>
<body>
  <h1>ğŸ“Š Ù¾Ø§Ù…Ù¾â€ŒÛŒØ§Ø¨ Ù‡ÙˆØ´Ù…Ù†Ø¯ â€” Ù†Ø¸Ø§Ø±Øª Ø²Ù†Ø¯Ù‡ Ø¨Ø± Ø¨Ø§Ø²Ø§Ø±</h1>

  <div class="controls">
    <select id="filterSignal">
      <option value="all">Ù‡Ù…Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§</option>
      <option value="PUMP">ÙÙ‚Ø· Ù¾Ø§Ù…Ù¾</option>
      <option value="DUMP">ÙÙ‚Ø· Ø¯Ø§Ù…Ù¾</option>
      <option value="NEUTRAL">Ø®Ù†Ø«ÛŒ</option>
    </select>

    <input type="number" id="minVolume" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Ø­Ø¬Ù… (0 = Ù‡Ù…Ù‡)" value="0" />
    <input type="number" id="minChange" placeholder="ØªØºÛŒÛŒØ± 1h (Ù…Ø«Ù„Ø§Ù‹ 5)" step="0.1" />

    <button onclick="loadData()">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø³ØªÛŒ</button>
  </div>

  <table id="dataTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">Ù†Ù…Ø§Ø¯ â–¼</th>
        <th onclick="sortTable(1)">Ù‚ÛŒÙ…Øª</th>
        <th onclick="sortTable(2)">ØªØºÛŒÛŒØ± 1h (%)</th>
        <th onclick="sortTable(3)">Ø­Ø¬Ù… ($)</th>
        <th onclick="sortTable(4)">RSI</th>
        <th onclick="sortTable(5)">MACD Hist</th>
        <th onclick="sortTable(6)">Ø³ÛŒÚ¯Ù†Ø§Ù„</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr><td colspan="7">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td></tr>
    </tbody>
  </table>

  <div class="status" id="status">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: â€”</div>

  <script>
    let currentData = [];
    let sortCol = null;
    let sortAsc = true;

    function loadData() {
      fetch('signals.json?t=' + new Date().getTime())
      //fetch('signals.json?t=')
        .then(res => res.json())
        .then(data => {
          currentData = data.coins || [];
          document.getElementById('status').textContent = 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + data.last_update;
          filterAndRender();
        })
        .catch(err => {
          document.getElementById('tableBody').innerHTML = `<tr><td colspan="7">âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† signals.json: ${err}</td></tr>`;
        });
    }

    function filterAndRender() {
      const signalFilter = document.getElementById('filterSignal').value;
      const minVolume = parseFloat(document.getElementById('minVolume').value) || 0;
      const minChange = parseFloat(document.getElementById('minChange').value) || -Infinity;

      let filtered = currentData.filter(item => {
        if (signalFilter !== 'all' && item.signal !== signalFilter) return false;
        if (item.volume < minVolume) return false;
        if (Math.abs(item.change_1h) < minChange) return false;
        return true;
      });

      // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
      if (sortCol !== null) {
        filtered.sort((a, b) => {
          let aVal = a[Object.keys(a)[sortCol]];
          let bVal = b[Object.keys(b)[sortCol]];
          if (typeof aVal === 'string') {
            return sortAsc ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
          }
          return sortAsc ? aVal - bVal : bVal - aVal;
        });
      }

      const tbody = document.getElementById('tableBody');
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
        return;
      }

      tbody.innerHTML = filtered.map(item => `
        <tr>
          <td><b>${item.symbol}</b></td>
          <td>$${item.price.toLocaleString()}</td>
          <td style="color: ${item.change_1h >= 0 ? '#4caf50' : '#f44336'}">${item.change_1h >= 0 ? '+' : ''}${item.change_1h}%</td>
          <td>$${(item.volume / 1e6).toFixed(2)}M</td>
          <td>${item.rsi}</td>
          <td>${item.macd_hist.toFixed(6)}</td>
          <td class="${item.signal.toLowerCase()}">${item.signal}</td>
        </tr>
      `).join('');
    }

    function sortTable(colIndex) {
      if (sortCol === colIndex) {
        sortAsc = !sortAsc;
      } else {
        sortCol = colIndex;
        sortAsc = true;
      }
      filterAndRender();
    }

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
    document.getElementById('filterSignal').addEventListener('change', filterAndRender);
    document.getElementById('minVolume').addEventListener('input', filterAndRender);
    document.getElementById('minChange').addEventListener('input', filterAndRender);

    // Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    loadData();
    setInterval(loadData, 15000); // Ù‡Ø± 15 Ø«Ø§Ù†ÛŒÙ‡ Ø¢Ù¾Ø¯ÛŒØª
  </script>
</body>
</html>